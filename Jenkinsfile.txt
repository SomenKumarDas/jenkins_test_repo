pipeline {
    agent any
    triggers {
        cron('H/5 * * * *')
    }
    stages {
        stage('Checkout') {
            steps {
                // Checkout the code
                checkout scm
            }
        }
        stage('Check Changes') {
            steps {
                script {
                    // Get the current change log
                    def changeLogSets = currentBuild.changeSets

                    if (changeLogSets.isEmpty()) {
                        echo 'DEBUG: No change'
                        currentBuild.result = 'SUCCESS'
                    } else {
                        echo 'DEBUG: Change Found'
                        currentBuild.result = 'NOT_BUILT'
                    }
                }
            }
        }
        stage('Build') {
            steps {
                script {
                    bat """
                    cd jenkins_test_repo
                    gcc test_code.c
                    echo "Build is complete"
                    """
                }
            }
        }
        stage('Execute') {
            steps {
                script {
                    bat """
                    cd jenkins_test_repo
                    call a.exe
                    echo "Executing is complete"
                    """
                }
            }
        }
    }
    post {
        always {
            script {
                // Display a summary of the changes, if any
                def changeLogSets = currentBuild.changeSets
                for (int i = 0; i < changeLogSets.size(); i++) {
                    def entries = changeLogSets[i].items
                    for (int j = 0; j < entries.length; j++) {
                        def entry = entries[j]
                        echo "Commit ${entry.commitId}: ${entry.msg}"
                        echo "Author: ${entry.author.fullName}"
                        echo "Date: ${new Date(entry.timestamp)}"
                        echo "Affected files:"
                        for (int k = 0; k < entry.affectedFiles.size(); k++) {
                            def affectedFile = entry.affectedFiles[k]
                            echo "  ${affectedFile.editType.name} ${affectedFile.path}"
                        }
                    }
                }
            }
        }
    }
}
